{"remainingRequest":"/Users/jifangli/Documents/work/project-tms-admin/node_modules/_vue-loader@15.7.1@vue-loader/lib/index.js??vue-loader-options!/Users/jifangli/Documents/work/project-tms-admin/src/views/login/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jifangli/Documents/work/project-tms-admin/src/views/login/index.vue","mtime":1564194254621},{"path":"/Users/jifangli/Documents/work/project-tms-admin/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jifangli/Documents/work/project-tms-admin/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/jifangli/Documents/work/project-tms-admin/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jifangli/Documents/work/project-tms-admin/node_modules/_vue-loader@15.7.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ResizeMixin from '@/views/layout/mixin/ResizeHandler'\nimport { mapGetters, mapMutations } from 'vuex'\nimport { login, userInfo } from '@/mock/'\n// import errRouterMap from '@/router/base/error'\nimport { formatMenuMap } from '@/utils/handleData'\n\nexport default {\n  name: 'Login',\n  mixins: [ResizeMixin],\n  data() {\n    const validateUsername = (rule, value, callback) => {\n      if (value.length < 1) {\n        callback(new Error('账号必须填写!'))\n      } else {\n        callback()\n      }\n    }\n    const validatePassword = (rule, value, callback) => {\n      if (value.length < 1) {\n        callback(new Error('密码必须填写!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      loginForm: {\n        username: '',\n        password: ''\n      },\n      loginRules: {\n        username: [{ required: true, trigger: 'blur', validator: validateUsername }],\n        password: [{ required: true, trigger: 'blur', validator: validatePassword }]\n      },\n      passwordType: 'password',\n      loading: false,\n      showDialog: false\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'themeColor',\n      'frontVersion',\n      'device'\n    ])\n  },\n  created() {\n    // this._getUserInfo()\n  },\n  methods: {\n    showPwd() {\n      if (this.passwordType === 'password') {\n        this.passwordType = ''\n      } else {\n        this.passwordType = 'password'\n      }\n    },\n    handleLogin() {\n      this.$refs.loginForm.validate(valid => {\n        if (valid) {\n          this.loading = true\n          // login(this.loginForm.username.trim(), this.loginForm.password.trim()).then(res => {\n          const data = login.data\n          this.setToken(data.token)\n\n          this._getUserInfo()\n          // }).catch(() => {\n          //   this.loading = false\n          // })\n        } else {\n          return false\n        }\n      })\n    },\n    _getUserInfo() {\n      // userInfo().then((res) => {\n      const data = userInfo.data\n      this.setBaseInfo(data.baseInfo)\n      const menuMap = formatMenuMap(data.permission)\n      let secondMenuIndex = null\n      if (menuMap[0] && menuMap[0].children[0] && menuMap[0].children[0].children[0]) {\n        secondMenuIndex = menuMap[0].children[0].children[0]\n      } else {\n        secondMenuIndex = { url: '/page/401' }\n      }\n\n      // 获取当前版本并加载当前版本的路由\n      let routers = require('@/router/admin/').default\n      routers = [].concat(routers, {\n        path: '/',\n        redirect: secondMenuIndex.url\n      })\n      this.$router.addRoutes(routers)\n\n      // 初始化菜单和默认显示菜单\n      this.setMenuMap(menuMap)\n      this.setMenuIndex([0, secondMenuIndex, secondMenuIndex.url])\n      // })\n    },\n    ...mapMutations({\n      setMenuMap: 'SET_MENU_MAP',\n      setMenuIndex: 'SET_MENU_INDEX',\n      setToken: 'SET_TOKEN',\n      setBaseInfo: 'SET_BASE_INFO'\n    })\n  }\n}\n",null]}